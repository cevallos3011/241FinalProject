---
title: "Master RMD"
author: "James C"
date: "4/30/2020"
output: pdf_document
---


#241 Final Project

##Clean Up Data
```{r}
library(haven)
library(dplyr)
togo_data_dhs <- read_dta("togo data dhs.dta")
new_data <- togo_data_dhs
new_data <- as.data.frame(new_data)
new_data <- new_data %>% select("v012", 
"v302a", 
"mv034b_1", 
"v190", 
"mv106",
"mv151",
"mv035", 
"v130",
"v312", 
"v362", 
"v393", 
"v394")

colnames(new_data) <- c("age_of_respondent",
"contraception", 
"age_of_partner", 
"wealth_index", 
"education_level",
"sex_of_household_head",
"num_of_partners", 
"religion", 
"current_contraceptive_method", 
"intention_to_use_current_contraceptive_method",
"visited_by_family_planning_worker_last_12 months", 
"visited_health_facility_last_twelve_months")
```

## Specific Data Manipulation - Creation of easy data
```{r}
#Filter out women who are older than 50 
easy_data <- new_data %>% filter(age_of_respondent <= 50)

#Filter out rows with N/As in any part of the data set
easy_data <- easy_data[!is.na(easy_data$intention_to_use_current_contraceptive_method),]
easy_data <- easy_data[!is.na(easy_data$religion),]
#Make a few variables binary
easy_data <- easy_data %>% mutate(age_greater_than_twenty_one = ifelse(age_of_respondent > 21, 1, 0))
easy_data <- easy_data %>% mutate(contraception_yes = ifelse(contraception >= 1, 1, 0))
easy_data$age_greater_than_twenty_one <- as.factor(easy_data$age_greater_than_twenty_one)
easy_data$contraception_yes <- as.factor(easy_data$contraception_yes)
```

## Library's needed for modeling  

```{r}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(foreign)
library(tidyverse)
library(epitools)
library(lmtest)
```

## Model 0 

Blah blah blah 

```{r}
model_zero <-glm(contraception_yes ~ 1, data=easy_data, 
           family =binomial("logit"))
summary(model_zero) # Model Results + Wald Test
lrtest(model_zero)# Likelihood Ratio Test
confint(model_zero)# Confidence Interval
```

## Models with single variable 

Let $X$ be a dummy variable equal to 1 if the age of partner is greater than or equal to 21 and zero otherwise. We fit a logistic model with this covariate.
  
  $$\log\left( \frac{p}{1-p}\right) = a + bX.$$
The null hypothesis is that the contraception is the same for everyone regardless of age and can be formulated as $H_0: b =0$ vs $H_1: b \neq 0.$

```{r}
model_one <-glm(contraception_yes~age_greater_than_twenty_one, data = easy_data, 
           family =binomial("logit"))
summary(model_one) # Model Results + Wald Test
lrtest(model_one)# Likelihood Ratio Test
confint(model_one)# Confidence Interval

broom::tidy(model_one,conf.int = TRUE,exponentiate = TRUE) #Odds ratio and it's 95% CI
```

## Models of single variable
  
We now define $X$ to be any one variable in our data set. We regress fit the logistic models for every single variable. 

$$\log\left( \frac{p}{1-p}\right) = a + bX.$$
We want to test $H0 : b= 0$.
```{r}
#1
 model_age_of_respondent <-glm(contraception_yes ~ age_of_respondent, data = easy_data, 
           family =binomial("logit"))

summary(model_age_of_respondent)# Model Results + Wald Test
lrtest(model_age_of_respondent)# Likelihood Ratio Test

#2
model_age_of_partner <-glm(contraception_yes ~ age_of_partner, data = easy_data, 
           family =binomial("logit"))

summary(model_age_of_partner)# Model Results + Wald Test
lrtest(model_age_of_partner)# Likelihood Ratio Test

#3
model_wealth_index <-glm(contraception_yes ~ wealth_index, data = easy_data, 
           family =binomial("logit"))

summary(model_wealth_index)# Model Results + Wald Test
lrtest(model_wealth_index)# Likelihood Ratio Test

#4
model_education_level <-glm(contraception_yes ~ education_level, data = easy_data, 
           family =binomial("logit"))

summary(model_education_level )# Model Results + Wald Test
lrtest(model_education_level )# Likelihood Ratio Test

#5
model_num_of_partners <-glm(contraception_yes ~  num_of_partners, data = easy_data, 
           family =binomial("logit"))

summary(model_num_of_partners)# Model Results + Wald Test
lrtest(model_num_of_partners)# Likelihood Ratio Test
           
#6
model_religion <-glm(contraception_yes ~religion, data = easy_data, 
           family =binomial("logit"))

summary(model_religion)# Model Results + Wald Test
lrtest(model_religion)# Likelihood Ratio Test

#7    
model_intention_to_use_current_contraceptive_method <-glm(contraception_yes ~ intention_to_use_current_contraceptive_method, data = easy_data, 
           family =binomial("logit"))

summary(model_intention_to_use_current_contraceptive_method)# Model Results + Wald Test
lrtest(model_intention_to_use_current_contraceptive_method)# Likelihood Ratio Test

#8
model_visited_health_facility_last_twelve_months <-glm(contraception_yes ~ visited_health_facility_last_twelve_months, data = easy_data, 
           family =binomial("logit"))

summary(model_visited_health_facility_last_twelve_months)# Model Results + Wald Test
lrtest(model_visited_health_facility_last_twelve_months)# Likelihood Ratio Test
     
#summary()# Model Results + Wald Test
#lrtest()# Likelihood Ratio Test
#confint()# Confidence Interval
#broom::tidy(,conf.int = TRUE,exponentiate = TRUE) #Odds ratio and it's 95% CI          
```

## Model of all variables together and likelihood ratio test of nested models 
  
We now add variables $X,Y,Z, etc..$ together in the same model and regress fit the logistic model. 

$$\log\left( \frac{p}{1-p}\right) = a +bX+cY+dZ... etc$$
We want to test $H0 : b= 0$.
```{r}
model_everything <-glm(contraception_yes ~ age_of_respondent + age_of_partner + wealth_index + education_level + num_of_partners + religion + intention_to_use_current_contraceptive_method + visited_health_facility_last_twelve_months, data= easy_data, family =binomial("logit"))

summary(model_everything)# Model Results + Wald Test
lrtest(model_everything)# Likelihood Ratio Test
```


## Comparison of all the models to see which is the best

blah blah blah


```{r}

##Ahh I can't get this to work! 
lrtest(model_everything, 
model_age_of_respondent, 
model_age_of_partner, 
model_wealth_index, 
model_education_level, 
model_num_of_partners, 
model_religion, 
model_intention_to_use_current_contraceptive_method, 
model_visited_health_facility_last_twelve_months)
```